### CVE-2020-20211

#### Description

The `console` process suffers from an assertion failure vulnerability. There is a reachable assertion in the console process. By sending a crafted packet, an authenticated remote user can crash the `console` process due to assertion failure.

Against stable `6.46.3`, the poc resulted in the following crash captured by `gdb`.

```shell
(gdb) c
Continuing.

Program received signal SIGABRT, Aborted.
=> 0x7775255b <raise+83>:       pop    ebx
   0x7775255c <raise+84>:       cmp    eax,0xfffff000
   0x77752561 <raise+89>:       jbe    0x77752571 <raise+105>
   0x77752563 <raise+91>:       mov    edx,DWORD PTR [ebx-0x34]
0x7775255b in raise () from target:/lib/libc.so.0
(gdb) i r
eax            0x0      0
ecx            0x105    261
edx            0x6      6
ebx            0x105    261
esp            0x7fe69288       0x7fe69288
ebp            0x7fe69290       0x7fe69290
esi            0x7775a200       2004197888
edi            0x0      0
eip            0x7775255b       0x7775255b <raise+83>
eflags         0x246    [ PF ZF IF ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb) info inferiors
  Num  Description       Executable
* 1    process 261       target:/nova/bin/console
```

And the crash dump in `/rw/logs/backtrace.log` was:

```shell
# cat /rw/logs/backtrace.log 
2020.05.16-21:19:30.73@0: 
2020.05.16-21:19:30.73@0: 
2020.05.16-21:19:30.74@0: /nova/bin/console
2020.05.16-21:19:30.74@0: --- signal=6 --------------------------------------------
2020.05.16-21:19:30.74@0: 
2020.05.16-21:19:30.74@0: eip=0x7775255b eflags=0x00000246
2020.05.16-21:19:30.74@0: edi=0x00000000 esi=0x7775a200 ebp=0x7fe69290 esp=0x7fe69288
2020.05.16-21:19:30.74@0: eax=0x00000000 ebx=0x00000105 ecx=0x00000105 edx=0x00000006
2020.05.16-21:19:30.74@0: 
2020.05.16-21:19:30.74@0: maps:
2020.05.16-21:19:30.74@0: 08048000-080bd000 r-xp 00000000 00:0c 1036       /nova/bin/console
2020.05.16-21:19:30.74@0: 77724000-77759000 r-xp 00000000 00:0c 964        /lib/libuClibc-0.9.33.2.so
2020.05.16-21:19:30.74@0: 7775d000-77777000 r-xp 00000000 00:0c 960        /lib/libgcc_s.so.1
2020.05.16-21:19:30.74@0: 77778000-77787000 r-xp 00000000 00:0c 944        /lib/libuc++.so
2020.05.16-21:19:30.74@0: 77788000-7778e000 r-xp 00000000 00:0c 949        /lib/libufiber.so
2020.05.16-21:19:30.74@0: 7778f000-777db000 r-xp 00000000 00:0c 946        /lib/libumsg.so
2020.05.16-21:19:30.74@0: 777e1000-777e8000 r-xp 00000000 00:0c 958        /lib/ld-uClibc-0.9.33.2.so
2020.05.16-21:19:30.74@0: 
2020.05.16-21:19:30.74@0: stack: 0x7fe6a000 - 0x7fe69288 
2020.05.16-21:19:30.74@0: 00 a0 75 77 00 a0 75 77 c8 92 e6 7f 77 e0 74 77 06 00 00 00 00 a2 75 77 20 00 00 00 00 00 00 00 
2020.05.16-21:19:30.74@0: 0c 93 e6 7f 28 93 e6 7f c4 92 e6 7f e4 ba 7d 77 01 00 00 00 e4 ba 7d 77 0c 93 e6 7f 00 00 00 00 
2020.05.16-21:19:30.74@0: 
2020.05.16-21:19:30.74@0: code: 0x7775255b
2020.05.16-21:19:30.74@0: 5b 3d 00 f0 ff ff 76 0e 8b 93 cc ff ff ff f7 d8 
2020.05.16-21:19:30.74@0: 
```

#### Affected Version

This vulnerability was initially found in long-term  `6.44.5`. It seems that the latest stable version `6.46.5` still suffers from this vulnerability.

#### Timeline

+ 2019/08/23 - report the vulnerability to the vendor
+ 2019/08/30 - vendor confirms the vulnerability and will fix it as soon as possible
+ 2020/04/14 - still no fix yet
+ 2021/05/04 - CVE is assigned



