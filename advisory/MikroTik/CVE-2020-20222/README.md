### CVE-2020-20222

#### Description

The `sniffer` process suffers from a memory corruption vulnerability. By sending a crafted packet, an authenticated remote user can crash the `sniffer` process due to NULL pointer dereference.

Against stable `6.46.5`, the poc resulted in the following crash captured by `gdb`.

```shell
(gdb) c
Continuing.

Program received signal SIGSEGV, Segmentation fault.
=> 0x8050e33:   or     ecx,DWORD PTR [eax+0xc]
   0x8050e36:   mov    edx,edi
   0x8050e38:   mov    eax,ebx
   0x8050e3a:   call   0x804ffbc
0x08050e33 in ?? ()
(gdb) i r
eax            0x0      0
ecx            0xff0000 16711680
edx            0x8059678        134583928
ebx            0x7f85c090       2139472016
esp            0x7f85c080       0x7f85c080
ebp            0x7f85c0c8       0x7f85c0c8
esi            0x7f85c094       2139472020
edi            0x8057a24        134576676
eip            0x8050e33        0x8050e33
eflags         0x10206  [ PF IF RF ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb) info inferiors
  Num  Description       Executable
* 1    process 195       target:/nova/bin/sniffer                  
```

And the crash dump in `/rw/logs/backtrace.log` was:

```shell
# cat /rw/logs/backtrace.log 
2020.06.19-16:36:18.33@0: 
2020.06.19-16:36:18.33@0: 
2020.06.19-16:36:18.33@0: /nova/bin/sniffer
2020.06.19-16:36:18.33@0: --- signal=11 --------------------------------------------
2020.06.19-16:36:18.33@0: 
2020.06.19-16:36:18.33@0: eip=0x08050e33 eflags=0x00010206
2020.06.19-16:36:18.33@0: edi=0x08057a24 esi=0x7f85c094 ebp=0x7f85c0c8 esp=0x7f85c080
2020.06.19-16:36:18.33@0: eax=0x00000000 ebx=0x7f85c090 ecx=0x00ff0000 edx=0x08059678
2020.06.19-16:36:18.33@0: 
2020.06.19-16:36:18.33@0: maps:
2020.06.19-16:36:18.33@0: 08048000-08056000 r-xp 00000000 00:0c 1034       /nova/bin/sniffer
2020.06.19-16:36:18.33@0: 776ce000-77703000 r-xp 00000000 00:0c 964        /lib/libuClibc-0.9.33.2.so
2020.06.19-16:36:18.33@0: 77707000-77721000 r-xp 00000000 00:0c 960        /lib/libgcc_s.so.1
2020.06.19-16:36:18.33@0: 77722000-77731000 r-xp 00000000 00:0c 944        /lib/libuc++.so
2020.06.19-16:36:18.33@0: 77732000-7773a000 r-xp 00000000 00:0c 950        /lib/libubox.so
2020.06.19-16:36:18.33@0: 7773b000-77787000 r-xp 00000000 00:0c 946        /lib/libumsg.so
2020.06.19-16:36:18.33@0: 7778d000-77794000 r-xp 00000000 00:0c 958        /lib/ld-uClibc-0.9.33.2.so
2020.06.19-16:36:18.33@0: 
2020.06.19-16:36:18.33@0: stack: 0x7f85d000 - 0x7f85c080 
2020.06.19-16:36:18.33@0: 2c 08 07 08 04 00 fe 08 fe 00 00 00 20 ad 05 08 00 0c 07 08 a0 0b 07 08 af 0b 07 08 04 7a 05 08 
2020.06.19-16:36:18.33@0: 08 00 00 00 24 7a 05 08 ff 00 00 00 00 00 00 00 08 c2 85 7f e4 7a 78 77 d8 c0 85 7f e4 7a 78 77 
2020.06.19-16:36:18.34@0: 
2020.06.19-16:36:18.34@0: code: 0x8050e33
2020.06.19-16:36:18.34@0: 0b 48 0c 89 fa 89 d8 e8 7d f1 ff ff 50 50 53 56
```

#### Affected Version

This vulnerability was initially found in long-term  `6.44.6`, and it seems that the latest stable version `6.48.2` still suffers from this vulnerability.

#### Timeline

+ 2020/01/06 - report the vulnerability to the vendor
+ 2020/01/07 - vendor confirms the vulnerability and will work on a fix
+ 2021/05/04 - CVE is assigned

