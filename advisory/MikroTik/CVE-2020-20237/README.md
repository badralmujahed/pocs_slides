### CVE-2020-20237

#### Description

The `sniffer` process suffers from a memory corruption vulnerability. By sending a crafted packet, an authenticated remote user can crash the `sniffer` process due to invalid memory access.

Against stable `6.46.5`, the poc resulted in the following crash dump.

```shell
# cat /rw/logs/backtrace.log 
2020.06.19-17:58:43.98@0: 
2020.06.19-17:58:43.98@0: 
2020.06.19-17:58:43.98@0: /nova/bin/sniffer
2020.06.19-17:58:43.98@0: --- signal=11 --------------------------------------------
2020.06.19-17:58:43.98@0: 
2020.06.19-17:58:43.98@0: eip=0x77712055 eflags=0x00010202
2020.06.19-17:58:43.98@0: edi=0x77720f34 esi=0x77721015 ebp=0x7ff96b38 esp=0x7ff96af8
2020.06.19-17:58:43.98@0: eax=0x77721054 ebx=0x7771f000 ecx=0x77721034 edx=0x77721014
2020.06.19-17:58:43.98@0: 
2020.06.19-17:58:43.98@0: maps:
2020.06.19-17:58:43.98@0: 08048000-08056000 r-xp 00000000 00:0c 1034       /nova/bin/sniffer
2020.06.19-17:58:43.98@0: 776e9000-7771e000 r-xp 00000000 00:0c 964        /lib/libuClibc-0.9.33.2.so
2020.06.19-17:58:43.98@0: 77722000-7773c000 r-xp 00000000 00:0c 960        /lib/libgcc_s.so.1
2020.06.19-17:58:43.98@0: 7773d000-7774c000 r-xp 00000000 00:0c 944        /lib/libuc++.so
2020.06.19-17:58:43.98@0: 7774d000-77755000 r-xp 00000000 00:0c 950        /lib/libubox.so
2020.06.19-17:58:43.98@0: 77756000-777a2000 r-xp 00000000 00:0c 946        /lib/libumsg.so
2020.06.19-17:58:43.98@0: 777a8000-777af000 r-xp 00000000 00:0c 958        /lib/ld-uClibc-0.9.33.2.so
2020.06.19-17:58:43.98@0: 
2020.06.19-17:58:43.98@0: stack: 0x7ff97000 - 0x7ff96af8 
2020.06.19-17:58:43.98@0: 00 f0 71 77 00 0f 72 77 30 00 00 00 00 00 00 00 38 b2 05 08 34 0f 72 77 04 00 00 00 00 0f 72 77 
2020.06.19-17:58:43.98@0: 20 00 00 00 1b 7b 71 77 e8 f1 71 77 98 00 00 00 01 00 00 00 ec c4 74 77 74 a1 05 08 f8 6b f9 7f 
2020.06.19-17:58:43.98@0: 
2020.06.19-17:58:43.98@0: code: 0x77712055
2020.06.19-17:58:43.98@0: 89 14 10 eb bc 8b 93 a4 ff ff ff 8b 7d e0 8b 42
```

Interestingly, the same poc resulted in another different crash dump(`SIGABRT`) against stable `6.48.2`.

```shell
# cat /rw/logs/backtrace.log
2021.05.07-16:02:37.25@0: 
2021.05.07-16:02:37.25@0: 
2021.05.07-16:02:37.25@0: /nova/bin/sniffer
2021.05.07-16:02:37.25@0: --- signal=6 --------------------------------------------
2021.05.07-16:02:37.25@0: 
2021.05.07-16:02:37.25@0: eip=0x776f255b eflags=0x00000246
2021.05.07-16:02:37.25@0: edi=0x0805aca8 esi=0x776fa200 ebp=0x7f97def8 esp=0x7f97def0
2021.05.07-16:02:37.25@0: eax=0x00000000 ebx=0x000000b6 ecx=0x000000b6 edx=0x00000006
2021.05.07-16:02:37.25@0: 
2021.05.07-16:02:37.25@0: maps:
2021.05.07-16:02:37.25@0: 08048000-08056000 r-xp 00000000 00:0c 1036       /nova/bin/sniffer
2021.05.07-16:02:37.25@0: 776c4000-776f9000 r-xp 00000000 00:0c 966        /lib/libuClibc-0.9.33.2.so
2021.05.07-16:02:37.25@0: 776fd000-77717000 r-xp 00000000 00:0c 962        /lib/libgcc_s.so.1
2021.05.07-16:02:37.25@0: 77718000-77727000 r-xp 00000000 00:0c 945        /lib/libuc++.so
2021.05.07-16:02:37.25@0: 77728000-77730000 r-xp 00000000 00:0c 951        /lib/libubox.so
2021.05.07-16:02:37.25@0: 77731000-7777d000 r-xp 00000000 00:0c 947        /lib/libumsg.so
2021.05.07-16:02:37.25@0: 77783000-7778a000 r-xp 00000000 00:0c 960        /lib/ld-uClibc-0.9.33.2.so
2021.05.07-16:02:37.25@0: 
2021.05.07-16:02:37.25@0: stack: 0x7f97f000 - 0x7f97def0 
2021.05.07-16:02:37.25@0: 00 a0 6f 77 00 a0 6f 77 30 df 97 7f 77 e0 6e 77 06 00 00 00 00 a2 6f 77 20 00 00 00 00 00 00 00 
2021.05.07-16:02:37.25@0: 26 2b 6f 77 00 a0 6f 77 28 df 97 7f 21 2c 6f 77 e8 a1 6f 77 00 a0 6f 77 00 bf 6f 77 a8 ac 05 08 
2021.05.07-16:02:37.25@0: 
2021.05.07-16:02:37.25@0: code: 0x776f255b
2021.05.07-16:02:37.25@0: 5b 3d 00 f0 ff ff 76 0e 8b 93 cc ff ff ff f7 d8
```

#### Affected Version

This vulnerability was initially found in long-term  `6.46.3`, and it seems that the latest stable version `6.48.2` suffers from an assertion failure vulnerability when running the same poc.

#### Timeline

+ 2020/02/26 - report the vulnerability to the vendor
+ 2020/02/27 - vendor confirms the vulnerability and will work on a fix
+ 2021/05/04 - CVE is assigned

