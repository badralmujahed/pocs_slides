### CVE-2021-36614

#### Description

The `tr069-client` process suffers from a memory corruption vulnerability. By sending a crafted packet, an authenticated remote user can crash the `tr069-client` process due to NULL pointer dereference.

Against stable `6.47`, the poc resulted in the following crash captured by `gdb`.

```shell
(gdb) c
Continuing.

Program received signal SIGSEGV, Segmentation fault.
=> 0x805a185:   push   DWORD PTR [eax]
   0x805a187:   push   0x1
   0x805a189:   push   esi
   0x805a18a:   call   0x804eb10 <_ZN2nv7message6insertINS_6u32_idEEEvT_NS_8IdTraitsIS3_E8set_typeE@plt>
0x0805a185 in ?? ()
(gdb) i r
eax            0x0      0
ecx            0x776924ec       2003379436
edx            0x7769187c       2003376252
ebx            0x80a9290        134910608
esp            0x7ff7497c       0x7ff7497c
ebp            0x7ff74988       0x7ff74988
esi            0x7ff74a04       2146912772
edi            0x7ff74a04       2146912772
eip            0x805a185        0x805a185
eflags         0x10206  [ PF IF RF ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb) info inferiors
  Num  Description       Executable
* 1    process 198       target:/ram/pckg/tr069-client/nova/bin/tr069-client
```

And the crash dump in `/rw/logs/backtrace.log` was:

```shell
# cat /rw/logs/backtrace.log 
2020.06.10-17:04:17.63@0: 
2020.06.10-17:04:17.63@0: 
2020.06.10-17:04:17.63@0: /ram/pckg/tr069-client/nova/bin/tr069-client
2020.06.10-17:04:17.63@0: --- signal=11 --------------------------------------------
2020.06.10-17:04:17.63@0: 
2020.06.10-17:04:17.63@0: eip=0x0805a185 eflags=0x00010206
2020.06.10-17:04:17.63@0: edi=0x7ff74a04 esi=0x7ff74a04 ebp=0x7ff74988 esp=0x7ff7497c
2020.06.10-17:04:17.63@0: eax=0x00000000 ebx=0x080a9290 ecx=0x776924ec edx=0x7769187c
2020.06.10-17:04:17.63@0: 
2020.06.10-17:04:17.63@0: maps:
2020.06.10-17:04:17.63@0: 08048000-08096000 r-xp 00000000 00:10 13         /ram/pckg/tr069-client/nova/bin/tr069-client
2020.06.10-17:04:17.63@0: 7762f000-77664000 r-xp 00000000 00:0c 966        /lib/libuClibc-0.9.33.2.so
2020.06.10-17:04:17.63@0: 77668000-77682000 r-xp 00000000 00:0c 962        /lib/libgcc_s.so.1
2020.06.10-17:04:17.63@0: 77683000-77692000 r-xp 00000000 00:0c 945        /lib/libuc++.so
2020.06.10-17:04:17.63@0: 77693000-7769d000 r-xp 00000000 00:0c 963        /lib/libm-0.9.33.2.so
2020.06.10-17:04:17.63@0: 7769f000-776bc000 r-xp 00000000 00:0c 948        /lib/libucrypto.so
2020.06.10-17:04:17.63@0: 776bd000-776c0000 r-xp 00000000 00:0c 954        /lib/libxml.so
2020.06.10-17:04:17.63@0: 776c1000-7770d000 r-xp 00000000 00:0c 947        /lib/libumsg.so
2020.06.10-17:04:17.63@0: 77710000-7771b000 r-xp 00000000 00:0c 955        /lib/libuhttp.so
2020.06.10-17:04:17.63@0: 7771c000-77724000 r-xp 00000000 00:0c 951        /lib/libubox.so
2020.06.10-17:04:17.63@0: 77728000-7772f000 r-xp 00000000 00:0c 960        /lib/ld-uClibc-0.9.33.2.so
2020.06.10-17:04:17.63@0: 
2020.06.10-17:04:17.63@0: stack: 0x7ff75000 - 0x7ff7497c 
2020.06.10-17:04:17.63@0: 10 a0 08 08 40 4b 72 77 90 92 0a 08 b8 49 f7 7f 7c fa 71 77 90 92 0a 08 04 4a f7 7f 05 00 00 00 
2020.06.10-17:04:17.63@0: 28 4a f7 7f b4 49 f7 7f 40 4b 72 77 88 5b 09 08 40 4b 72 77 80 4d f7 7f 04 4a f7 7f 28 4a f7 7f 
2020.06.10-17:04:17.63@0: 
2020.06.10-17:04:17.63@0: code: 0x805a185
2020.06.10-17:04:17.63@0: ff 30 6a 01 56 e8 81 49 ff ff 83 c4 0c ff 73 24 
2020.06.10-17:04:17.63@0
```

#### Affected Version

This vulnerability was initially found in stable  `6.47`, and was fixed in stable `6.48.2`.

#### Timeline

+ 2021/03/01 - reported the vulnerability to the vendor
+ 2021/03/18 - the vendor reproduced and confirmed the vulnerability
+ 2021/06/01 - the vendor responded that it was fixed in stable `6.48.2`
+ 2022/05/12 - CVE was assigned  



