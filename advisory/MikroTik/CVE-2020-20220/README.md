### CVE-2020-20220

#### Description

The `bfd` process suffers from a memory corruption vulnerability. By sending a crafted packet, an authenticated remote user can crash the `bfd` process due to invalid memory access.

Against stable `6.46.5`, the poc resulted in the following crash captured by `gdb`.

```shell
Thread 2.1 "bfd" received signal SIGSEGV, Segmentation fault.
=> 0x804b175:   inc    DWORD PTR ds:0x0
   0x804b17b:   add    esp,0x10
   0x804b17e:   leave
   0x804b17f:   ret
0x0804b175 in ?? ()
(gdb) i r
eax            0x8050634        134546996
ecx            0x8051274        134550132
edx            0x1      1
ebx            0x77777af0       2004318960
esp            0x7f9d3e70       0x7f9d3e70
ebp            0x7f9d3e88       0x7f9d3e88
esi            0x8054298        134562456
edi            0x8054a90        134564496
eip            0x804b175        0x804b175
eflags         0x10202  [ IF RF ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb) info inferiors
  Num  Description       Executable
  1    <null>            target:/ram/pckg/routing/nova/bin/bfd
* 2    process 306       target:/ram/pckg/routing/nova/bin/bfd               
```

And the crash dump in `/rw/logs/backtrace.log` was:

```shell
# cat /rw/logs/backtrace.log 
2020.06.19-18:36:13.88@0: 
2020.06.19-18:36:13.88@0: 
2020.06.19-18:36:13.88@0: /ram/pckg/routing/nova/bin/bfd
2020.06.19-18:36:13.88@0: --- signal=11 --------------------------------------------
2020.06.19-18:36:13.88@0: 
2020.06.19-18:36:13.88@0: eip=0x0804b175 eflags=0x00010202
2020.06.19-18:36:13.88@0: edi=0x08054a90 esi=0x08054298 ebp=0x7f9d3e88 esp=0x7f9d3e70
2020.06.19-18:36:13.88@0: eax=0x08050634 ebx=0x77777af0 ecx=0x08051274 edx=0x00000001
2020.06.19-18:36:13.88@0: 
2020.06.19-18:36:13.88@0: maps:
2020.06.19-18:36:13.88@0: 08048000-08050000 r-xp 00000000 00:1b 16         /ram/pckg/routing/nova/bin/bfd
2020.06.19-18:36:13.88@0: 7759a000-7759c000 r-xp 00000000 00:0c 959        /lib/libdl-0.9.33.2.so
2020.06.19-18:36:13.88@0: 7759e000-775d3000 r-xp 00000000 00:0c 964        /lib/libuClibc-0.9.33.2.so
2020.06.19-18:36:13.88@0: 775d7000-775f1000 r-xp 00000000 00:0c 960        /lib/libgcc_s.so.1
2020.06.19-18:36:13.88@0: 775f2000-77601000 r-xp 00000000 00:0c 944        /lib/libuc++.so
2020.06.19-18:36:13.88@0: 77602000-7775f000 r-xp 00000000 00:0c 954        /lib/libcrypto.so.1.0.0
2020.06.19-18:36:13.88@0: 7776f000-77777000 r-xp 00000000 00:0c 950        /lib/libubox.so
2020.06.19-18:36:13.88@0: 77778000-777c4000 r-xp 00000000 00:0c 946        /lib/libumsg.so
2020.06.19-18:36:13.88@0: 777ca000-777d1000 r-xp 00000000 00:0c 958        /lib/ld-uClibc-0.9.33.2.so
2020.06.19-18:36:13.88@0: 
2020.06.19-18:36:13.88@0: stack: 0x7f9d4000 - 0x7f9d3e70 
2020.06.19-18:36:13.88@0: 34 06 05 08 d0 e6 04 08 d8 3e 9d 7f 90 4a 05 08 98 42 05 08 d8 3e 9d 7f f8 3e 9d 7f 6d 39 77 77 
2020.06.19-18:36:13.88@0: 90 4a 05 08 28 40 9d 7f 05 00 00 00 00 43 05 08 00 00 00 00 28 90 7c 77 01 00 00 00 0c 00 00 00 
2020.06.19-18:36:13.88@0: 
2020.06.19-18:36:13.88@0: code: 0x804b175
2020.06.19-18:36:13.88@0: ff 05 00 00 00 00 83 c4 10 c9 c3 55 89 e5 53 83
```

#### Affected Version

This vulnerability was initially found in long-term  `6.44.6`, and it seems that the latest stable version `6.48.2` still suffer from this vulnerability.

#### Timeline

+ 2020/01/06 - report the vulnerability to the vendor
+ 2020/01/07 - vendor confirms the vulnerability and will work on a fix
+ 2021/05/04 - CVE is assigned

