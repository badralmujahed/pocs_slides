### CVE-2020-20267

#### Description

The `resolver` process suffers from a memory corruption vulnerability. By sending a crafted packet, an authenticated remote user can crash the `resolver` process due to invalid memory access.

Against stable `6.46.5`, the poc resulted in the following crash captured by `gdb`.

```shell
(gdb) c
Continuing.

Program received signal SIGSEGV, Segmentation fault.
=> 0x80508f6:   mov    BYTE PTR [eax],dl
   0x80508f8:   mov    eax,DWORD PTR [ebx+0x14]
   0x80508fb:   inc    eax
   0x80508fc:   mov    DWORD PTR [ebx+0x14],eax
0x080508f6 in ?? ()
(gdb) i r
eax            0xc      12
ecx            0x77676f00       2003267328
edx            0x5      5
ebx            0x8061c98        134618264
esp            0x7fe5fcc0       0x7fe5fcc0
ebp            0x7fe5fd08       0x7fe5fd08
esi            0x8062018        134619160
edi            0x8060620        134612512
eip            0x80508f6        0x80508f6
eflags         0x10206  [ PF IF RF ]
cs             0x73     115
ss             0x7b     123
ds             0x7b     123
es             0x7b     123
fs             0x0      0
gs             0x33     51
(gdb) info inferiors
  Num  Description       Executable
* 1    process 197       target:/nova/bin/resolver                     
```

And the crash dump in `/rw/logs/backtrace.log` was:

```shell
# cat /rw/logs/backtrace.log 
2020.06.18-14:38:03.27@0: 
2020.06.18-14:38:03.27@0: 
2020.06.18-14:38:03.28@0: /nova/bin/resolver
2020.06.18-14:38:03.28@0: --- signal=11 --------------------------------------------
2020.06.18-14:38:03.28@0: 
2020.06.18-14:38:03.28@0: eip=0x080508f6 eflags=0x00010206
2020.06.18-14:38:03.28@0: edi=0x08060620 esi=0x08062018 ebp=0x7fe5fd08 esp=0x7fe5fcc0
2020.06.18-14:38:03.28@0: eax=0x0000000c ebx=0x08061c98 ecx=0x77676f00 edx=0x00000005
2020.06.18-14:38:03.28@0: 
2020.06.18-14:38:03.28@0: maps:
2020.06.18-14:38:03.28@0: 08048000-0805c000 r-xp 00000000 00:0c 995        /nova/bin/resolver
2020.06.18-14:38:03.28@0: 7763f000-77674000 r-xp 00000000 00:0c 964        /lib/libuClibc-0.9.33.2.so
2020.06.18-14:38:03.28@0: 77678000-77692000 r-xp 00000000 00:0c 960        /lib/libgcc_s.so.1
2020.06.18-14:38:03.28@0: 77693000-776a2000 r-xp 00000000 00:0c 944        /lib/libuc++.so
2020.06.18-14:38:03.28@0: 776a3000-776ab000 r-xp 00000000 00:0c 950        /lib/libubox.so
2020.06.18-14:38:03.28@0: 776ac000-776f8000 r-xp 00000000 00:0c 946        /lib/libumsg.so
2020.06.18-14:38:03.28@0: 776fe000-77705000 r-xp 00000000 00:0c 958        /lib/ld-uClibc-0.9.33.2.so
2020.06.18-14:38:03.28@0: 
2020.06.18-14:38:03.28@0: stack: 0x7fe60000 - 0x7fe5fcc0 
2020.06.18-14:38:03.28@0: 03 00 00 00 e4 8a 6f 77 38 fd e5 7f e4 fc e5 7f c0 dc 05 08 5c 03 e6 7f 08 fd e5 7f 1f e7 04 08 
2020.06.18-14:38:03.28@0: 58 21 06 08 48 06 06 08 f8 1f 06 08 c0 0c 00 00 1c fd e5 7f 28 c7 05 08 02 fb 6f 77 98 1c 06 08 
2020.06.18-14:38:03.28@0: 
2020.06.18-14:38:03.28@0: code: 0x80508f6
2020.06.18-14:38:03.28@0: 88 10 8b 43 14 40 89 43 14 8b 55 dc 8d 72 04 8b
```

#### Affected Version

This vulnerability was initially found in long-term  `6.44.6`, and was fixed in stable `6.47`.

#### Timeline

+ 2020/01/06 - reported the vulnerability to the vendor
+ 2020/01/07 - the vendor confirmed the vulnerability
+ 2020/06/02 - the vendor fixed it in stable `6.47`
+ 2021/05/04 - CVE was assigned

